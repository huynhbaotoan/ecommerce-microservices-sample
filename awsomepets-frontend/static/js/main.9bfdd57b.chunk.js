(this["webpackJsonpawsomepets-frontend"]=this["webpackJsonpawsomepets-frontend"]||[]).push([[0],{102:function(e,t,n){},103:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){"use strict";n.r(t);var a=n(11),c=n(0),r=n.n(c),s=n(12),i=n.n(s),o=(n(90),n(75)),l=n(18),u=n(14),d=n(162),j=n(149),b=(n(91),n(142)),O=n(146),m=n(147),h=n(108),p=n(148),f=n(9),v={basket:[],total:0,itemCount:0,inventoryStatus:"",message:"",orderId:""},x="addItem",g="removeItem",y="removeAll",k="clearBasket",C="validateInventory",N="failed",S="reserved",w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case x:var r=e.basket.slice(),s=r.map((function(e){return e.id})).indexOf(c.id);if(s<0)r.push(Object(a.a)(Object(a.a)({},c),{},{quantity:1,subtotal:c.unitPrice}));else{var i=r[s];i.quantity++,i.subtotal=i.quantity*i.unitPrice}var o=r.map((function(e){return e.subtotal})).reduce((function(e,t){return e+t}),0),l=r.map((function(e){return e.quantity})).reduce((function(e,t){return e+t}),0);e={basket:r,total:o,itemCount:l};break;case g:var u=e.basket.slice(),d=u.map((function(e){return e.id})).indexOf(c.id);if(d>-1){var j=u[d];j.quantity>1?(j.quantity--,j.subtotal=j.quantity*j.unitPrice):u.splice(d,1);var b=u.map((function(e){return e.subtotal})).reduce((function(e,t){return e+t}),0),O=u.map((function(e){return e.quantity})).reduce((function(e,t){return e+t}),0);e={basket:u,total:b,itemCount:O}}break;case y:var m=e.basket.slice(),h=m.map((function(e){return e.id})).indexOf(c.id);if(h>-1){m.splice(h,1);var p=m.map((function(e){return e.subtotal})).reduce((function(e,t){return e+t}),0),f=m.map((function(e){return e.quantity})).reduce((function(e,t){return e+t}),0);e={basket:m,total:p,itemCount:f}}break;case k:e={basket:[],total:0,itemCount:0};break;case N:var C=e.basket.slice(),w=C.map((function(e){return e.subtotal})).reduce((function(e,t){return e+t}),0),I=C.map((function(e){return e.quantity})).reduce((function(e,t){return e+t}),0),q="";c.items.forEach((function(e){return q+=e.title+" has only "+e.itemsInStock+" in stock now. "})),e={basket:C,total:w,itemCount:I,inventoryStatus:"failed",message:q};break;case S:var P=e.basket.slice(),A=P.map((function(e){return e.subtotal})).reduce((function(e,t){return e+t}),0),z=P.map((function(e){return e.quantity})).reduce((function(e,t){return e+t}),0);e={basket:P,total:A,itemCount:z,orderId:c.orderId}}return e},I=n(2),q=function(e){var t=e.item,n=Object(f.b)();return Object(I.jsxs)(b.a,{className:"item-card",children:[Object(I.jsxs)("div",{children:[Object(I.jsx)(O.a,{className:"item-image",image:t.imageUrl,title:t.title}),Object(I.jsxs)(m.a,{className:"item-detail",children:[Object(I.jsx)(h.a,{gutterBottom:!0,variant:"h5",component:"h2",children:t.title}),Object(I.jsxs)("span",{children:["$",t.unitPrice]})]})]}),Object(I.jsx)(p.a,{children:Object(I.jsx)(j.a,{size:"small",color:"primary",onClick:function(){n({type:x,payload:t})},children:"Add to cart"})})]})},P=(n(97),{headers:{"Content-Type":"application/json"}}),A=document.querySelector("link[rel='api-root']"),z=void 0;function E(e,t,n){return z&&"/"===e.charAt(0)&&(e=z+e),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",c=Object(a.a)(Object(a.a)({},P),t);if(c.method=n,"object"===typeof c.body&&c.headers){"application/json"===c.headers["Content-Type"]&&(c.body=JSON.stringify(c.body))}return c.headers&&(c.headers=new Headers(c.headers)),fetch(e,c).then((function(e){return e.ok?e:e.json().then((function(t){throw{code:e.status,message:t.message}}))})).then((function(e){return e.json()})).catch((function(e){throw e}))}(e,t,n)}A&&(z=A.getAttribute("href"))&&"/"===z.charAt(z.length-1)&&(z=z.slice(0,z.length-1));var T=function(){var e=Object(c.useContext)(xe).endpoints,t=Object(c.useState)([]),n=Object(l.a)(t,2),a=n[0],r=n[1];return Object(c.useEffect)((function(){E(e.catalogue).then((function(e){r(e)}))}),[]),Object(I.jsx)("div",{className:"page-offer",children:Object(I.jsx)("div",{className:"item-results",children:a.map((function(e,t){return Object(I.jsx)(q,{item:e},t)}))})})},U=n(163),F=n(159),$=(n(98),{status:"new",orderId:"",message:"",clientCallbackUrl:""}),R="placeOrderRequest",W="placeOrderSuccess",D="placeOrderFailure",M="processOrderRequest",B="processOrderSuccess",J="processOrderFailure",Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case W:e=Object(a.a)(Object(a.a)({},e),{},{status:c.status?c.status:"placed",clientCallbackUrl:c.clientCallbackUrl,orderId:c.orderId});break;case D:e=Object(a.a)(Object(a.a)({},e),{},{status:c.status?c.status:"error",message:c.message,clientCallbackUrl:void 0});break;case B:e=Object(a.a)(Object(a.a)({},e),{},{status:c.status?c.status:"success",orderId:c.orderId,amountPaid:c.amountPaid});break;case J:e=Object(a.a)(Object(a.a)({},e),{},{status:c.status?c.status:"failed",orderId:c.orderId,message:c.message,clientCallbackUrl:void 0});break;case"validateInventory":e=Object(a.a)(Object(a.a)({},e),{},{status:"new",clientCallbackUrl:void 0})}return e},G=(n(99),function(e){var t=e.basketItem;return Object(I.jsxs)("li",{className:"line-item",children:[Object(I.jsx)("span",{className:"item-title",children:t.title}),Object(I.jsxs)("span",{className:"item-quantity",children:[" x",t.quantity]}),Object(I.jsxs)("span",{className:"subtotal",children:["$",t.subtotal]})]})}),L=function(e){var t=e.basket,n=e.total;return Object(I.jsxs)("ul",{children:[t.map((function(e,t){return Object(I.jsx)(G,{basketItem:e},t)})),Object(I.jsxs)("li",{className:"line-item total",children:[Object(I.jsx)("span",{className:"total-label",children:"Total"}),Object(I.jsxs)("span",{className:"total-value",children:["$",n]})]},"total")]})},V=n(152),H=n(161),K=n(151),Q=function(e){return(e=e.replaceAll("-","")).length<17},X=function(){var e=Object(c.useContext)(xe).endpoints,t=Object(f.b)(),n=Object(u.g)(),a=Object(c.useState)("123 Some Street"),r=Object(l.a)(a,2),s=r[0],i=r[1],o=Object(c.useState)("Singapore"),d=Object(l.a)(o,2),b=d[0],O=d[1],m=Object(c.useState)("2880"),h=Object(l.a)(m,2),p=h[0],v=h[1],x=Object(c.useState)("4111-1111-1111-1111"),g=Object(l.a)(x,2),y=g[0],k=g[1],C=Object(c.useState)("Nguyen Van A"),N=Object(l.a)(C,2),S=N[0],w=N[1],q=Object(c.useState)("11/22"),P=Object(l.a)(q,2),A=P[0],z=P[1],T=Object(c.useState)("222"),$=Object(l.a)(T,2),Y=$[0],G=$[1],X=Object(f.c)((function(e){return e.cart.basket})),Z=Object(f.c)((function(e){return e.cart.total})),_=Object(f.c)((function(e){return e.cart.itemCount})),ee=Object(f.c)((function(e){return e.cart.orderId})),te=Object(f.c)((function(e){return e.order.status})),ne=Object(f.c)((function(e){return e.order.message})),ae=Object(f.c)((function(e){return e.order.clientCallbackUrl})),ce=Object(f.c)((function(e){return e.order.orderId})),re=Object(f.c)((function(e){return e.status.loading})),se=re.indexOf("placeOrder")>-1||re.indexOf("processOrder")>-1;Object(c.useEffect)((function(){0===_&&n.push("/")}),[]),Object(c.useEffect)((function(){"success"!==te&&"processed"!==te||n.push("/confirmation")}),[te]),Object(c.useEffect)((function(){var e;ae&&(t({type:M}),(e=ae,new Promise((function(t,n){var a=new WebSocket(e);a.onopen=function(){console.log("Listening to order status update at ",e),setTimeout((function(){a.readyState===WebSocket.OPEN&&(console.log("Refreshing request for orderId:",ce),a.send(JSON.stringify({orderId:ce})))}),5e3),setTimeout((function(){a.readyState===WebSocket.OPEN&&(a.close(),n(new Error("Websocket timeout")))}),9e4)},a.onmessage=function(e){try{var c=JSON.parse(e.data);"success"===c.status?(a.close(),t(c)):"failed"===c.status&&(a.close(),n(c))}catch(r){a.close(),n(r)}},a.onerror=function(){n(new Error("Websocket error"))}}))).then((function(e){t({type:B,payload:e})})).catch((function(e){t({type:J,payload:e})})))}),[ae]);var ie=function(){t(function(){var n={basket:X.map((function(e){return{id:e.id,title:e.title,quantity:e.quantity}})),orderId:ee,shippingAddress:{address:s,city:b,postCode:p},paymentDetail:{cardNumber:y,cardholderName:S,expiry:A,ccv:Y}};return t({type:R}),function(t){E(e.placeOrder,{body:n},"POST").then((function(e){400===e.statusCode?t({type:D,payload:e}):t({type:W,payload:{clientCallbackUrl:e.clientCallbackUrl,orderId:e.orderId}})})).catch((function(e){t({type:D,payload:e})}))}}())};return Object(I.jsxs)("div",{className:"page-payment",children:[Object(I.jsx)("div",{className:"side-bar",children:Object(I.jsx)(L,{basket:X,total:Z})}),Object(I.jsx)("div",{className:"main-content",children:Object(I.jsxs)("form",{onSubmit:function(e){return e.preventDefault(),ie(),!1},onReset:function(e){window.location.href="/",e.preventDefault()},children:[Object(I.jsx)("h3",{children:"Shipping Address"}),Object(I.jsx)(U.a,{className:"address",fullWidth:!0,margin:"normal",children:Object(I.jsx)(F.a,{name:"address",label:"Address",variant:"outlined",value:s,onChange:function(e){i(e.target.value)}})}),Object(I.jsx)(U.a,{className:"city",margin:"normal",children:Object(I.jsx)(F.a,{name:"city",label:"City",variant:"outlined",value:b,onChange:function(e){O(e.target.value)}})}),Object(I.jsx)(U.a,{className:"postCode",margin:"normal",children:Object(I.jsx)(F.a,{name:"postCode",label:"Post Code",variant:"outlined",value:p,onChange:function(e){v(e.target.value)}})}),Object(I.jsx)("h3",{children:"Payment Details"}),Object(I.jsx)(U.a,{className:"cardNumber",fullWidth:!0,margin:"normal",children:Object(I.jsx)(F.a,{name:"cardNumber",label:"Card Number",variant:"outlined",error:!Q(y),helperText:Q(y)?null:"Credit card number too long",value:y,onChange:function(e){(function(e){return 0===(e=e.replaceAll("-","")).length||/^\d+$/.test(e)})(e.target.value)&&k(function(e){var t=(e=e.replaceAll("-","")).match(/.{1,4}/g);return t?t.join("-"):""}(e.target.value))}})}),Object(I.jsx)(U.a,{className:"cardholderName",margin:"normal",children:Object(I.jsx)(F.a,{name:"cardholderName",label:"Cardholder Name",variant:"outlined",value:S,onChange:function(e){w(e.target.value)}})}),Object(I.jsx)(U.a,{className:"expiry",margin:"normal",children:Object(I.jsx)(F.a,{name:"expiry",label:"Expiry Date",variant:"outlined",value:A,onChange:function(e){(function(e){return 0===(e=e.replaceAll("/","")).length||/^\d+$/.test(e)})(e.target.value)&&z(function(e){return(e=e.replaceAll("/","").slice(0,4)).length>2?[e.slice(0,2),"/",e.slice(2)].join(""):e}(e.target.value))}})}),Object(I.jsx)(U.a,{className:"ccv",margin:"normal",children:Object(I.jsx)(F.a,{name:"ccv",label:"CCV",variant:"outlined",value:Y,onChange:function(e){(function(e){return 0===e.length||/^\d+$/.test(e)})(e.target.value)&&G(e.target.value.slice(0,3))}})}),"error"===te||"failed"===te?Object(I.jsx)(H.a,{severity:"error",className:"error",children:Object(I.jsx)(K.a,{children:ne})}):null,"placed"===te?Object(I.jsxs)(H.a,{severity:"success",children:[Object(I.jsx)(K.a,{children:"Your order has been submitted"}),"Awaiting order processing status update for order reference:",Object(I.jsx)("br",{}),Object(I.jsx)("b",{children:ce})]}):null,Object(I.jsxs)("div",{className:"buttons",children:[Object(I.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[Object(I.jsx)(j.a,{type:"submit",color:"primary",size:"large",variant:"contained",disabled:se,children:"Confirm Payment"}),Object(I.jsx)(V.a,{size:24,className:"progress ".concat(se?"submitting":null)})]}),Object(I.jsx)(j.a,{type:"reset",size:"large",variant:"contained",disabled:se,children:"Cancel"})]})]})})]})},Z=(n(102),[{path:"/",label:"offer",pageContent:T},{path:"/payment",label:"payment",pageContent:X,props:{hideCart:!0}},{path:"/confirmation",label:"confirmation",pageContent:function(){var e=Object(f.c)((function(e){return e.order.orderId})),t=Object(f.c)((function(e){return e.order.amountPaid})),n=Object(f.b)();return Object(c.useEffect)((function(){n({type:k})}),[]),Object(I.jsxs)("div",{className:"confirmation",children:[Object(I.jsxs)("p",{children:["Thank you for shopping at Octank Awsome Store. You have paid an amount of $",t]}),Object(I.jsxs)("p",{children:["Your order reference is ",Object(I.jsx)("b",{children:e}),"."]}),Object(I.jsx)("div",{className:"buttons",children:Object(I.jsx)(j.a,{color:"primary",size:"medium",variant:"contained",onClick:function(){window.location.href="/"},children:"Back to shopping"})})]})},props:{hideCart:!0}}]),_=n(153),ee=n(154);var te=function(e){var t=Object(u.g)(),n=e.toggleNavMenu,a=e.hideCart,c=Object(f.c)((function(e){return e.cart.itemCount}));return Object(I.jsx)("header",{children:Object(I.jsxs)("div",{className:"header-content",children:[Object(I.jsx)("div",{className:"header-section",children:Object(I.jsxs)("a",{className:"logo",href:"#",onClick:function(){return t.push("/"),!1},children:[Object(I.jsx)("span",{className:"narrow",children:"Awsome"}),Object(I.jsx)("span",{className:"bold",children:"Store"})]})}),Object(I.jsx)("div",{className:"header-section",children:a?null:Object(I.jsxs)(j.a,{onClick:n,children:[Object(I.jsx)(_.a,{style:{fontSize:30}}),Object(I.jsx)(ee.a,{style:{marginTop:16},badgeContent:c,color:"secondary",vertical:"bottom"})]})})]})})};var ne=function(e){return Object(I.jsx)("footer",{})},ae=(n(103),n(104),n(105),n(157)),ce=n(155),re=n(156),se=n(150),ie=function(e){var t=e.basketItem,n=Object(f.b)();return Object(I.jsxs)("div",{className:"cart-item",children:[Object(I.jsx)(O.a,{className:"item-image",image:t.imageUrl,title:t.title}),Object(I.jsxs)("div",{style:{padding:8,borderBottom:"1px solid #ccc",flex:"1 1 auto",margin:8},children:[Object(I.jsxs)("div",{className:"item-detail",children:[Object(I.jsx)("h4",{children:t.title}),Object(I.jsxs)("span",{className:"subtotal",children:["$",t.subtotal]})]}),Object(I.jsxs)("div",{className:"item-quantity",children:[Object(I.jsxs)("span",{children:[Object(I.jsx)(se.a,{size:"small",onClick:function(){n({type:g,payload:t})},children:Object(I.jsx)(ce.a,{})}),Object(I.jsx)("span",{children:t.quantity}),Object(I.jsx)(se.a,{size:"small",onClick:function(){n({type:x,payload:t})},children:Object(I.jsx)(re.a,{})})]}),Object(I.jsx)(se.a,{size:"small",onClick:function(){n({type:y,payload:t})},children:Object(I.jsx)(ae.a,{})})]})]})]})},oe=n(158),le=function(e){var t=e.close,n=Object(u.g)(),a=Object(c.useContext)(xe).endpoints,r=Object(f.b)(),s=Object(f.c)((function(e){return e.cart.basket})),i=Object(f.c)((function(e){return e.cart.total})),o=Object(f.c)((function(e){return e.cart.itemCount})),l=Object(f.c)((function(e){return e.cart.inventoryStatus})),d=Object(f.c)((function(e){return e.cart.message}));return Object(I.jsxs)("div",{className:"shopping-cart",children:[Object(I.jsx)("div",{className:"header",children:Object(I.jsx)(se.a,{onClick:t,children:Object(I.jsx)(oe.a,{})})}),s.length>0?Object(I.jsxs)("div",{children:[Object(I.jsx)("div",{className:"basket",children:s.map((function(e,t){return Object(I.jsx)(ie,{basketItem:e},t)}))}),Object(I.jsxs)("div",{className:"total-row",children:[Object(I.jsx)("span",{children:"Total"}),Object(I.jsxs)("span",{className:"total",children:["$",i]})]})]}):Object(I.jsx)("div",{className:"empty-basket",children:"Your shopping cart is empty"}),"error"===l||"failed"===l?Object(I.jsx)(H.a,{severity:"error",className:"error",children:Object(I.jsx)(K.a,{children:d})}):null,Object(I.jsx)("div",{className:"actions",children:Object(I.jsx)(j.a,{className:"checkout-button",disabled:o<1,variant:"contained",color:"primary",size:"medium",onClick:function(){r(function(){var e={basket:s.map((function(e){return{id:e.id,title:e.title,quantity:e.quantity}}))};return r({type:C}),function(c){E(a.inventory,{body:e},"POST").then((function(e){400===e.statusCode?c({type:N,payload:e}):(c({type:S,payload:e}),t(),n.push("payment"))})).catch((function(e){c({type:N,payload:e})}))}}())},children:"Checkout"})})]})},ue=["content","hideCart","navGroup","toggleNavMenu"];function de(e){var t=e.content,n=e.hideCart,a=e.navGroup,c=e.toggleNavMenu,s=Object(o.a)(e,ue);return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(te,{routes:Z,selected:a,toggleNavMenu:c,hideCart:n}),Object(I.jsx)("div",{className:"workspace-content",children:r.a.createElement(t,s)})]})}var je=function(){var e=Object(c.useState)(!1),t=Object(l.a)(e,2),n=t[0],s=t[1],i=function(e){void 0===e&&(e=!n),s(e)};return Object(I.jsxs)("div",{children:[Object(I.jsxs)(u.d,{children:[Z.map((function(e,t){return Object(I.jsx)(u.b,{path:e.path,exact:void 0!==e.exact?e.exact:!(e.props&&e.props.routes),render:function(){return r.a.createElement(de,Object(a.a)(Object(a.a)({},e.props),{},{content:e.pageContent,toggleNavMenu:i}))}},t)})),Object(I.jsx)(u.b,{exact:!0,path:"/",children:Object(I.jsx)(u.a,{to:"/"})})]}),Object(I.jsx)(ne,{}),Object(I.jsx)(d.a,{anchor:"right",open:n,onClose:function(){i(!1)},children:Object(I.jsx)(le,{close:function(){i(!1)}})})]})},be=n(73),Oe=n(46),me=n(72),he=n(62),pe=new RegExp("(.*)(Request|Success|Failure)"),fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:[],errors:{}},t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload,r=pe.exec(n);if(!r)return e;var s=Object(l.a)(r,3),i=s[1],o=s[2],u=e.loading.indexOf(i);if("Request"===o)return-1===u?Object(a.a)(Object(a.a)({},e),{},{loading:[].concat(Object(he.a)(e.loading),[i])}):e;u>-1&&e.loading.splice(u,1);var d=Object(a.a)({},e.errors);return"Success"===o?delete d[i]:"Failure"===o&&(d[i]=c),Object(a.a)(Object(a.a)({},e),{},{loading:Object(he.a)(e.loading),errors:d})},ve=n(35),xe=r.a.createContext({});function ge(){var e=Object(me.composeWithDevTools)({});return Object(Oe.createStore)(Object(Oe.combineReducers)({status:fe,cart:w,order:Y}),e(Object(Oe.applyMiddleware)(be.a)))}var ye=function(e){return Object(I.jsx)(xe.Provider,{value:e,children:Object(I.jsx)(f.a,{store:ge(),children:Object(I.jsx)(ve.a,{children:Object(I.jsx)(je,{})})})})},ke=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,165)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))},Ce=n(74),Ne=document.getElementById("root");i.a.render(Object(I.jsx)(r.a.StrictMode,{children:Object(I.jsx)(ye,Object(a.a)({},Ce))}),Ne),ke()},74:function(e){e.exports=JSON.parse('{"endpoints":{"catalogue":"https://z2jsgnki3g.execute-api.ap-southeast-1.amazonaws.com/v1/catalogue","placeOrder":"https://z2jsgnki3g.execute-api.ap-southeast-1.amazonaws.com/v1/order","inventory":"https://z2jsgnki3g.execute-api.ap-southeast-1.amazonaws.com/v1/inventory"}}')},90:function(e,t,n){},91:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){},99:function(e,t,n){}},[[106,1,2]]]);
//# sourceMappingURL=main.9bfdd57b.chunk.js.map